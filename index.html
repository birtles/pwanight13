<!doctype html>
<html lang=ja>
<head>
<meta charset=utf-8>
<title>PWA開発者の知るべきアニメーションの5個</title>
<meta name="title" content="PWA開発者の知るべきアニメーションの5個">
<meta name="author" content="Brian Birtles">

<meta property="og:title" content="PWA開発者の知るべきアニメーションの5個">
<meta property="og:type" content="article">
<meta property="og:url" content="https://birtles.github.io/pwanight13/index.html">
<meta property="og:article:published_time" content="2020-02-19T00:00:00+0000">
<meta property="og:article:author" content="Brian Birtles">
<meta property="og:image"
  content="https://birtles.github.io/pwanight13/preview.png">
<meta property="og:image:width" content="1200">
<meta property="og:image:height" content="675">
<meta property="og:locale" content="ja_JP">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:site" content="@brianskold">

<meta name="apple-mobile-web-app-title" content="PWA開発者の知るべきアニメーションの5個">
<meta name="theme-color" content="#3d6bd6">
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
<meta name="viewport"
  content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">

<link rel="stylesheet" href="css/reveal.css">
<link rel="stylesheet" href="css/theme/pwanight13.css" id="theme">

<!-- For syntax highlighting -->
<link rel="stylesheet" href="lib/css/github-gist.css">

<!-- Printing and PDF exports -->
<script>
const link = document.createElement('link');
link.rel = 'stylesheet';
link.type = 'text/css';
link.href = window.location.search.match(/print-pdf/gi)
  ? 'css/print/pdf.css'
  : 'css/print/paper.css';
document.getElementsByTagName('head')[0].appendChild(link);
</script>

<script src="js/react.development.js"></script>
<script src="js/react-dom.development.js"></script>

<style>
.reveal pre {
  font-size: 24px;
  display: block;
  position: relative;
  width: 90%;
  margin: 15px auto;
  text-align: left;
  font-family: monospace;
  line-height: 1.2em;
  word-wrap: break-word;
  box-shadow: 0px 0px 6px rgba(0, 0, 0, 0.3);
}

.reveal pre code {
  font-family: "Courier New", monospace;
  word-wrap: normal;
  text-align: left;
  padding: 1em;
  font-weight: bold;
}

.reveal pre code .highlight {
  background-color: var(--green-10);
}

/*********************************************
 * CODE SAMPLE AND LIVE PREVIEW
 *********************************************/
.reveal .slides .side-by-side {
  display: flex;
  justify-content: space-around;
  align-items: center;
}
.reveal .slides .side-by-side > .target-content {
  padding-left: 1em;
  padding-right: 1em;
}

/*********************************************
 * SORT OF FULL-SCREEN PICTURE, but not cropped
 *********************************************/
.reveal .slides > section.fit-picture {
  padding: 0;
  margin: 0;
}

.reveal .fit-picture > img {
  height: 700px;
  border: 0;
  margin: 0;
}

/*********************************************
 * COMPATIBILITY NOTES
 *********************************************/
.reveal .compat-note {
  position: absolute;
  display: inline-block;
  top: 1em;
  right: 1em;
  left: 1em;
  z-index: 100;
  padding: 1em;
  background: hsl(48, 100%, 88%);
  box-shadow: 5px 10px 5px hsla(42, 15%, 13%, 0.3);
}
</style>
</head>

<body>
<div class="reveal">
<div class="slides">

<section id="title" class="title-slide" data-background="var(--green-10)">
<h1>
  PWA開発者の知るべき<br>
  <span class="highlight">アニメーションの5個</span>
</h1>
<h2>
  PWA Night vol. 13・<time datetime="2020-02-19">2020-02-19</time><br>
  <a href="https://birchill.co.jp">株式会社 Birchill</a>,
  <a href="https://twitter.com/brianskold">Brian Birtles</a>
</h2>
<style>
#title h1 {
  font-size: 80px;
  font-weight: 800;
  color: var(--green-dark);
  line-height: 1.2;
}
#title h1 .highlight {
  color: var(--red-6);
  font-size: 100px;
  text-shadow: var(--red-2) 0px 3px 3px;
}
#title h1 .parenthetical {
  font-family: 'Nanum Pen Script';
  font-size: 0.5em;
  font-weight: 400;
}
#title h2 {
  margin-top: 2.5em;
  color: var(--green-dark);
  font-size: 40px;
  font-weight: 600;
}
#title h2 a,
#title h2 a:visited {
  color: var(--green-dark);
  text-decoration: underline dotted var(--green-dark) 2px;
}
</style>
</section>

<section id="about-me">
<h2>自己紹介</h2>
<ul class="grid">
  <li class="fragment fade-in"><img src="img/koala.svg"></li>
  <li class="fragment fade-in"><img src="img/tokyo-tower.svg"></li>
  <li class="fragment fade-in"><figure><img
      src="img/firefox-logo.svg"><figcaption>2004~2019</figcaption></figure></li>
  <li class="fragment fade-in"><figure><img
      src="img/w3c-member.svg"><figcaption class=smaller>SVG WG 2011~<br>
        CSS WG 2015~</figcaption></figure></li>
  <li class="fragment fade-in"><figure><a href="https://birchill.co.jp"><img
      src="img/birchill-logo.svg"></a><figcaption>2019~</figcaption
    ></figure></li>
</ul>
<style>
#about-me ul.grid {
  display: flex;
  flex-wrap: wrap;
  justify-content: center;
  width: 100%;
  margin: 0;
}
#about-me ul.grid li {
  list-style: none;

  width: 240px;
  height: 240px;
  border-radius: 120px;
  margin-left: 5px;
  margin-right: 5px;

  display: flex;
  justify-content: center;
  align-items: center;
  text-align: center;
}
#about-me ul.grid li.fragment.current-fragment {
  background: var(--green-10);
}
#about-me ul.grid li > img {
  width: 200px;
  border: none;
  box-shadow: none;
  background: transparent;
}
#about-me ul.grid li > img.shrink {
  width: 150px;
}
#about-me ul.grid li > figure {
  display: flex;
  flex-direction: column;
  align-items: center;
  height: 100%;
  justify-content: center;
}
#about-me ul.grid li > figure > a {
  /*
   * I simply ran out of time to work out what on earth flex box is doing here.
   * CSS is the worst.
   */
  display: contents;
}
#about-me ul.grid li > figure > * {
  /* If I use flex: 1, Chrome does something awful */
  flex: 0 1 auto;
}
#about-me ul.grid li > figure img {
  border: none;
  margin: 0;
  width: 140px;
  box-shadow: none;
  background: transparent;
}
#about-me ul.grid li > figure > figcaption {
  font-size: 25px;
  margin-top: 15px;
}
#about-me ul.grid li > figure > figcaption.smaller {
  font-size: 20px;
}
</style>
</section>

<section id="about-birchill">
<h2><a href="https://birchill.co.jp" target=_blank><img class=logo
      src="img/birchill-logo-yoko.svg"></a>とは&hellip;</h2>
<ul>
  <li>株式会社<ruby>Birchill<rp>(<rt>バーチル<rp>)</ruby>
  <li>令和元年6月設立
  <li>全員元Mozilla Firefoxエンジニア
  <li>現在に至るまでブラウザー開発
    <ul>
      <li>C++, Rust, JS
    </ul>
  <li class=fragment>Webアプリの開発
    <ul>
      <li>TypeScript, React/Preact, Redux, PouchDB
      <li>Tailwind CSS
    </ul>
</ul>
<style>
#about-birchill h2 {
  margin-bottom: 1em;
}
#about-birchill h2 .logo {
  height: 1em;
  border-width: 0;
  box-shadow: none;
  margin: 0;
  margin-bottom: -.1em;
}
#about-birchill > ul > li {
  margin-bottom: 0.5em;
}
#about-birchill ul ul {
  font-size: 70%;
}
</style>
</section>

<section id="in-past-episodes">
<h2>以前&hellip;</h2>
<ul>
  <li>
    <a href="https://birtles.github.io/mozdev2019/" target="_blank"><img
      src="img/cssconf2019.png" alt="10 things I wish people knew about Web
      animation"></a>
    <span class=title>10 things I wish people knew about Web animation</span>
    <span class=link><a href="https://birtles.github.io/cssconf2019/"
      target=_blank>birtles.github.io/cssconf2019/</a></span>
    <span class=event>CSSConf 2019</span>
    <span class=location>深セン</span>
    <span class=date>2019-03-30</span>
  <li>
    <a href="https://birtles.github.io/cssconf2019/" target="_blank"><img
      src="img/mozdev2019.png" alt="10 things I hate about animation (and how to
      fix them)"></a>
    <span class=title>アニメーションについて嫌いな10個</span>
    <span class=link><a href="https://birtles.github.io/mozdev2019/"
      target=_blank>birtles.github.io/mozdev2019/</a></span>
    <span class=event>MDN Developer Roadshow</span>
    <span class=location>東京、ソール</span>
    <span class=date>2019-11-11, 2019-11-13</span>
<ul>
<style>
#in-past-episodes ul {
  display: grid;
  grid-template-columns: 1fr 1fr;
  justify-content: center;
  width: 100%;
  margin: 0;
}
#in-past-episodes ul li {
  list-style: none;

  display: flex;
  flex-direction: column;
  align-items: center;
  text-align: center;

  font-size: 25px;
}
#in-past-episodes ul li img {
  width: 350px;
  display: block;
}
#in-past-episodes ul li .title {
  font-weight: 600;
}
</style>
</section>

<section id="title-again">
<h1>
  PWA開発者の知るべき<br>
  <span class="highlight">アニメーションの5個</span>
</h1>
<style>
#title-again h1 {
  font-size: 70px;
  font-weight: 800;
  color: var(--green-dark);
  line-height: 1.4;
}
#title-again h1 .highlight {
  color: var(--red-6);
  font-size: 80px;
  text-shadow: var(--red-2) 0px 3px 3px;
}
</style>
</section>

<section id="transitions-are-hard-ok" data-background="var(--green-10)">
  <h2>① CSS Transitionを発生させるため、<span class=highlight>「スタイルの変更」</span></h2>
<style>
#transitions-are-hard-ok .highlight {
  color: var(--red-6);
  text-shadow: var(--red-2) 0px 3px 3px;
}
</style>
</section>

<section id="css-transitions-button" data-transition="fade-in">
<div class="side-by-side">
  <pre><code class="css" data-trim contenteditable=true
  spellcheck=false>
.button {
  background: hsl(77, 86%, 81%);
  transition: background-color .25s,
              transform .15s;
}
.button:hover {
  background: hsl(77, 86%, 91%);
  transform: scale(1.05);
}
  </code></pre>
  <div class="target-content">
    <button class="button">Button</button>
  </div>
</div>
<style>
#css-transitions-button .side-by-side > .target-content .button {
  border: 2px solid var(--green-dark);
  color: var(--green-dark);
  border-radius: 10px;
  box-shadow: 1px 2px 3px 0 hsla(106.8, 37%, 36.1%, 30%);
  padding: 1em;
  font-size: 30px;
  -webkit-appearance: none;
  -moz-appearance: none;
}
#css-transitions-button .side-by-side > .target-content .button {
  background: hsl(76.7, 86%, 81%);
  transition: background-color .25s,
              transform .15s;
}
#css-transitions-button .side-by-side > .target-content .button:hover {
  background: hsl(76.7, 86%, 91%);
  transform: scale(1.05);
}
</style>
</section>

<section id="css-transitions-in-a-pwa" class="panel-example">
<button class="button">Button</button>
<script>
(() => {
  const button = document.querySelector(
    '#css-transitions-in-a-pwa .button'
  );
  const parent = document.querySelector('#css-transitions-in-a-pwa');

  button.onclick = () => {
    // If there is an existing panel, remove it
    const existingPanel = document.querySelector(
      '#css-transitions-in-a-pwa .panel'
    );
    if (existingPanel) {
      existingPanel.remove();
      return;
    }

    // Create the panel
    const panel = document.createElement('div');
    panel.classList.add('panel');
    panel.textContent = 'ハロー！';
    panel.onclick = () => panel.remove();
    parent.appendChild(panel);

    // Stretch it in
    panel.style.transform = 'scale(0)';
    getComputedStyle(panel).transform;
    panel.style.transition = 'transform .5s';
    panel.style.transform = 'scale(1)';
  };
})();
</script>
<style>
.panel-example .panel {
  position: absolute;
  width: 10em;
  top: 0;
  left: calc(50% - 5em);
  z-index: 10;
  background: white;
  border: 1px solid hsl(41, 8%, 61%);
  border-radius: 20px;
  box-sizing: border-box;
  box-shadow: 3px 3px 5px hsl(41, 8%, 61%);
  padding: 1em;
}
.panel-example .button {
  font-size: 30px;
  margin: 2em;
}
</style>
</section>

<section id="css-transitions-overlay-code" class="panel-example">
<div class="side-by-side">
  <pre><code class="hljs js" data-trim data-noescape>
button.onclick = () => {
<span class="highlight fragment">  // パネルを作る
  const panel = document.createElement('div');
  panel.classList.add('panel');
  panel.textContent = 'ハロー！';
  parent.appendChild(panel);</span>

<span class="highlight fragment">  // アニメーションさせる
  panel.style.transform = 'scale(0)';
  panel.style.transition = 'transform .5s';
  panel.style.transform = 'scale(1)';</span>
};
  </code></pre>
  <div>
    <button class="button">Button</button>
  </div>
</div>
<script>
(() => {
  const button = document.querySelector(
    '#css-transitions-overlay-code .button'
  );
  const parent = document.querySelector('#css-transitions-overlay-code');

  button.onclick = () => {
    // If there is an existing panel, remove it
    const existingPanel = document.querySelector(
      '#css-transitions-overlay-code .panel'
    );
    if (existingPanel) {
      existingPanel.remove();
      return;
    }

    // Create the panel
    const panel = document.createElement('div');
    panel.classList.add('panel');
    panel.textContent = 'ハロー！';
    parent.appendChild(panel);

    // Stretch in
    panel.style.transform = 'scale(0)';
    panel.style.transition = 'transform .5s';
    panel.style.transform = 'scale(1)';
  };
})();
</script>
<style>
#css-transitions-overlay-code .fragment.highlight {
  opacity: 1;
  visibility: visible;
  background-color: transparent;
}
#css-transitions-overlay-code .fragment.highlight.current-fragment {
  background-color: var(--green-10);
}
</style>
</section>

<section id="css-transitions-frame-timing" data-transition="fade">
<svg width="800" viewBox="0 0 960 700" class="frame-timing">
  <defs>
    <marker id="arrow-neutral-4" viewBox="0 -5 10 10" orient="auto"
      markerWidth="5" markerHeight="5">
      <path d="M0-5l10 5l-10 5z" style="fill: var(--neutral-4)"/>
    </marker>
    <marker id="arrow-neutral-4-reverse" viewBox="-10 -5 10 10" orient="auto"
      markerWidth="5" markerHeight="5">
      <path d="M0-5l-10 5l10 5z" style="fill: var(--neutral-4)"/>
    </marker>
    <svg id="mini-panel" viewBox="0 0 100 100">
      <defs>
        <filter id="panel-shadow" filterUnits="userSpaceOnUse"
          x="0" y="0" width="100" height="100">
          <feDropShadow dx="2" dy="2" stdDeviation="2" flood-color="#222"
            flood-opacity="0.4"/>
        </filter>
      </defs>
      <rect x="2" y="2" width="90" height="90" rx="5" ry="5" fill="white"
        stroke="#222" filter="url(#panel-shadow)"/>
      <text x="45" y="50" text-anchor="middle" font-size="15">ハロー！</text>
    </svg>
  </defs>
  <g class="frame-outline">
    <rect x="40" y="250" width="400" height="200" />
    <rect x="520" y="250" width="400" height="200" />
  </g>
  <g class="frame-label fragment">
    <text x="240" y="490">Frame 1</text>
    <text x="720" y="490">Frame 2</text>
  </g>
  <g class="fragment">
    <rect x="40" y="250" width="50" height="200" class="style"/>
    <text x="63" y="265" class="vertical-label">Style</text>
    <rect x="520" y="250" width="50" height="200" class="style"/>
    <text x="543" y="265" class="vertical-label">Style</text>
    <g class="hide">
      <line x1="80" x2="65" y1="190" y2="250" class="connecting-line" />
      <rect x="65" y="70" width="300" height="120" rx="10" ry="10"
        class="callout" />
      <text x="80" y="110" class="code">display: block;
        <tspan x="80" dy="1.3em">opacity: 0;</tspan>
        <tspan x="80" dy="1.3em">transform: scale(1.5);</tspan></text>
    </g>
    <g class="hide">
      <line x1="560" x2="545" y1="190" y2="250" class="connecting-line" />
      <rect x="545" y="70" width="300" height="120" rx="10" ry="10"
        class="callout" />
      <text x="560" y="110" class="code">display: block;
        <tspan x="560" dy="1.3em">opacity: 1;</tspan>
        <tspan x="560" dy="1.3em">transform: scale(1.5);</tspan></text>
    </g>
  </g>
  <g class="fragment">
    <rect x="91" y="250" width="50" height="200" class="layout"/>
    <text x="114" y="265" class="vertical-label">Layout</text>
    <rect x="571" y="250" width="50" height="200" class="layout"/>
    <text x="594" y="265" class="vertical-label">Layout</text>
    <g class="hide">
      <line x1="130" x2="116" y1="210" y2="250" class="connecting-line" />
      <g transform="translate(115 50)">
        <rect width="180" height="160" rx="10" ry="10" class="callout" />
        <rect x="20" y="30" width="100" height="100" class="element-outline" />
        <line x1="135" x2="135" y1="40" y2="120" class="element-dimension"/>
        <text x="155" y="80" class="dimension-label"
          style="writing-mode: vertical-rl">120px</text>
      </g>
    </g>
    <g class="hide">
      <line x1="610" x2="596" y1="210" y2="250" class="connecting-line" />
      <g transform="translate(595 50)">
        <rect width="180" height="160" rx="10" ry="10" class="callout" />
        <rect x="20" y="30" width="100" height="100" class="element-outline" />
        <line x1="135" x2="135" y1="40" y2="120" class="element-dimension"/>
        <text x="155" y="80" class="dimension-label"
          style="writing-mode: vertical-rl">120px</text>
      </g>
    </g>
  </g>
  <g class="fragment">
    <rect x="142" y="250" width="50" height="200" class="painting"/>
    <text x="165" y="265" class="vertical-label">Painting</text>
    <line x1="180" x2="167" y1="200" y2="250" class="connecting-line" />
    <rect x="165" y="50" width="150" height="150" rx="10" ry="10"
      class="callout"/>
    <use href="#mini-panel" x="190" y="80" width="100" height="100"
      opacity="0.2"/>

    <rect x="622" y="250" width="50" height="200" class="painting"/>
    <text x="645" y="265" class="vertical-label">Painting</text>
    <line x1="660" x2="647" y1="200" y2="250" class="connecting-line" />
    <rect x="645" y="50" width="150" height="150" rx="10" ry="10"
      class="callout"/>
    <use href="#mini-panel" x="670" y="80" width="100" height="100"/>
  </g>
</svg>
<style>
.frame-timing .frame-outline {
  fill: var(--neutral-8);
  stroke: var(--neutral-6);
  stroke-width: 2;
}
.frame-timing .frame-label {
  fill: var(--neutral-5);
  font-size: 30px;
  text-anchor: middle;
}
.frame-timing .callout {
  fill: white;
  stroke: var(--neutral-4);
  stroke-width: 2px;
  stroke-dasharray: 3px 7px;
  stroke-linecap: round;
}
.frame-timing .connecting-line {
  stroke: var(--neutral-4);
  stroke-width: 2px;
  stroke-dasharray: 3px 7px;
  stroke-linecap: round;
  fill: none;
}
.frame-timing .style,
.frame-timing .layout {
  fill: var(--style-purple);
  stroke: var(--style-purple-dark);
  stroke-width: 2px;
}
.frame-timing .painting {
  fill: var(--green-light);
  stroke: var(--green);
  stroke-width: 2px;
}
.frame-timing .vertical-label {
  writing-mode: vertical-rl;
  fill: var(--neutral-1);
  font-size: 30px;
}
.frame-timing .code {
  fill: var(--neutral-1);
  font-size: 20px;
  font-family: "Courier New", monospace;
}
.frame-timing .element-outline {
  stroke: var(--neutral-4);
  fill: none;
}
.frame-timing .element-dimension {
  stroke: var(--neutral-4);
  stroke-width: 2px;
  marker-start: url(#arrow-neutral-4-reverse);
  marker-end: url(#arrow-neutral-4);
}
.frame-timing .dimension-label {
  fill: var(--neutral-4);
  text-anchor: middle;
  font-size: 20px;
}

#css-transitions-frame-timing .fragment .hide {
  transition: opacity .3s;
}
#css-transitions-frame-timing .fragment:not(.current-fragment) .hide {
  opacity: 0;
}
</style>
</section>

<section id="css-transitions-creation" class="frame-explanation"
  data-transition="fade">
<svg width="800" viewBox="0 0 960 700" class="frame-timing">
  <g class="frame-outline">
    <rect x="40" y="250" width="400" height="200" />
    <rect x="520" y="250" width="400" height="200" />
  </g>
  <g class="frame-label">
    <text x="240" y="490">Frame 1</text>
    <text x="720" y="490">Frame 2</text>
  </g>
  <g>
    <rect x="40" y="250" width="50" height="200" class="style"/>
    <text x="63" y="265" class="vertical-label">Style</text>
    <rect x="520" y="250" width="50" height="200" class="style"/>
    <text x="543" y="265" class="vertical-label">Style</text>
    <g>
      <line x1="80" x2="65" y1="190" y2="250" class="connecting-line" />
      <rect x="65" y="70" width="300" height="120" rx="10" ry="10"
        class="callout" />
      <text x="80" y="110" class="code">display: block;
        <tspan x="80" dy="1.3em" class=highlight>opacity: 0;</tspan>
        <tspan x="80" dy="1.3em">transform: scale(1.5);</tspan></text>
    </g>
    <g>
      <line x1="560" x2="545" y1="190" y2="250" class="connecting-line" />
      <rect x="545" y="70" width="300" height="120" rx="10" ry="10"
        class="callout" />
      <text x="560" y="110" class="code">display: block;
        <tspan x="560" dy="1.3em" class=highlight>opacity: 1;</tspan>
        <tspan x="560" dy="1.3em">transform: scale(1.5);</tspan></text>
    </g>
  </g>
  <g>
    <rect x="91" y="250" width="50" height="200" class="layout"/>
    <text x="114" y="265" class="vertical-label">Layout</text>
    <rect x="571" y="250" width="50" height="200" class="layout"/>
    <text x="594" y="265" class="vertical-label">Layout</text>
  </g>
  <g>
    <rect x="142" y="250" width="50" height="200" class="painting"/>
    <text x="165" y="265" class="vertical-label">Painting</text>
    <rect x="622" y="250" width="50" height="200" class="painting"/>
    <text x="645" y="265" class="vertical-label">Painting</text>
  </g>
</svg>
<div class="popup fragment">
  <ul>
    <li><span class="prop-name">opacity</span>の変更
      <span class="prop-value">0</span> &rarr;
      <span class="prop-value">1</span> !
    <li><span class="prop-name">transition-property</span> に
      <span class="prop-name">opacity</span> が含まれており&hellip;
    <li>対応する<span class="prop-name">transition-duration</span>
      <code>+</code>
      <span class="prop-name">transition-delay</span>
      <code>&gt;</code> <span class="prop-value">0s</span>&hellip;
    <li><span class="action">&rArr; transitionを生成する！🎉</span>
  </ul>
</div>
<style>
.frame-timing .code .highlight {
  fill: var(--style-purple-dark);
  font-weight: bold;
}
.frame-explanation .popup {
  width: 80%;
  margin-left: auto;
  margin-right: auto;
  position: relative;
  top: -150px;
  font-size: 25px;
  background: white;
  border: 1px solid var(--neutral-6);
  border-radius: 20px;
  box-sizing: border-box;
  box-shadow: 3px 3px 5px var(--neutral-8);
  padding: 1em;
}
.frame-explanation .popup .prop-name {
  color: var(--green-dark);
}
.frame-explanation .popup .prop-value {
  color: var(--pink);
}
.frame-explanation .action {
  color: var(--style-purple-dark);
  font-weight: 500;
}
</style>
</section>

<section id="css-transitions-overlay-problem" class="frame-explanation"
  data-transition="fade">
<svg width="800" viewBox="0 0 960 700" class="frame-timing">
  <g class="frame-outline">
    <rect x="40" y="250" width="400" height="200" />
    <rect x="520" y="250" width="400" height="200" />
  </g>
  <g class="frame-label">
    <text x="240" y="490">Frame 1</text>
    <text x="720" y="490">Frame 2</text>
  </g>
  <g>
    <rect x="40" y="250" width="50" height="200" class="style"/>
    <text x="63" y="265" class="vertical-label">Style</text>
    <rect x="91" y="250" width="50" height="200" class="layout"/>
    <text x="114" y="265" class="vertical-label">Layout</text>
    <rect x="142" y="250" width="50" height="200" class="painting"/>
    <text x="165" y="265" class="vertical-label">Painting</text>
  </g>
  <g class="fragment" data-fragment-index="1">
    <line x1="233" x2="233" y1="210" y2="250" class="connecting-line" />
  </g>
  <g class="fragment" data-fragment-index="0">
    <rect x="193" y="250" width="80" height="200" class="script"/>
    <text x="245" y="265" class="vertical-label">Script
      <tspan dx="-1em" y="265">(onclick)</tspan></text>
  </g>
  <g class="fragment" data-fragment-index="3">
    <line x1="545" x2="545" y1="450" y2="540" class="connecting-line" />
  </g>
  <g class="fragment" data-fragment-index="2">
    <rect x="520" y="250" width="50" height="200" class="style"/>
    <text x="543" y="265" class="vertical-label">Style</text>
  </g>
</svg>
<div class="code-block fragment" data-fragment-index="1">
  <pre><code class="hljs js" data-trim>
  button.onclick = () => {
    const panel = document.createElement('div');
    ...
    panel.style.transform = 'scale(0)';
    panel.style.transition = 'transform .5s';
    panel.style.transform = 'scale(1)';
  };
  </code></pre>
</div>
<div class="popup fragment" data-fragment-index="3">
  <ul>
    <li><span class="prop-name">transform</span> は <span
              class="prop-value">scale(1)</span>.
    <li>前回の <span class="prop-name">transform</span> は... ない.
  </ul>
</div>
<style>
.frame-timing .script {
  fill: var(--script-yellow);
  stroke: var(--script-yellow-dark);
  stroke-width: 2px;
}
#css-transitions-overlay-problem > .code-block {
  display: flex;
  position: absolute;
  top: 20px;
  width: 100%;
}
#css-transitions-overlay-problem > .code-block > pre {
  font-size: 15px;
  flex: 0 1 50%;
}
</style>
</section>

<section id="css-transitions-attempt-one" class="panel-example"
  data-transition="fade-out">
<div class="side-by-side">
  <pre><code class="hljs js" data-trim data-noescape>
button.onclick = () => {
  // パネルを作る
  const panel = document.createElement('div');
  ...

  // アニメーションさせる
  panel.style.transform = 'scale(0)';
  panel.style.transition = 'transform .5s';
<span class="highlight">  requestAnimationFrame(() => {
    panel.style.transform = 'scale(1)';
  });</span>
};
  </code></pre>
  <div>
    <button class="button">Button</button>
  </div>
</div>
<script>
(() => {
  const button = document.querySelector(
    '#css-transitions-attempt-one .button'
  );
  const parent = document.querySelector('#css-transitions-attempt-one');

  button.onclick = () => {
    // If there is an existing panel, remove it
    const existingPanel = document.querySelector(
      '#css-transitions-attempt-one .panel'
    );
    if (existingPanel) {
      existingPanel.remove();
      return;
    }

    // Create the panel
    const panel = document.createElement('div');
    panel.classList.add('panel');
    panel.textContent = 'ハロー！';
    parent.appendChild(panel);

    // Stretch in
    panel.style.transform = 'scale(0)';
    // There is something very buggy with Chrome here. If you move the following
    // line _inside_ the rAF you actually DO get a transition (but you
    // shouldn't).
    panel.style.transition = 'transform .5s';
    requestAnimationFrame(() => {
      panel.style.transform = 'scale(1)';
    });
  };
})();
</script>
</section>

<section id="css-transitions-attempt-one-explanation"
  class="frame-explanation" data-transition="fade">
<svg width="800" viewBox="0 0 960 700" class="frame-timing">
  <g class="frame-outline">
    <rect x="40" y="250" width="400" height="200" />
    <rect x="520" y="250" width="400" height="200" />
  </g>
  <g class="frame-label">
    <text x="240" y="490">Frame 1</text>
    <text x="720" y="490">Frame 2</text>
  </g>
  <g>
    <rect x="40" y="250" width="50" height="200" class="style"/>
    <text x="63" y="265" class="vertical-label">Style</text>
    <rect x="91" y="250" width="50" height="200" class="layout"/>
    <text x="114" y="265" class="vertical-label">Layout</text>
    <rect x="142" y="250" width="50" height="200" class="painting"/>
    <text x="165" y="265" class="vertical-label">Painting</text>
  </g>
  <line x1="233" x2="233" y1="210" y2="250" class="connecting-line" />
  <rect x="193" y="250" width="80" height="200" class="script"/>
  <text x="245" y="265" class="vertical-label">Script
    <tspan dx="-1em" y="265">(onclick)</tspan></text>
  <g class="fragment" data-fragment-index="1">
    <rect x="520" y="250" width="60" height="200" class="script"/>
    <text x="560" y="265" class="vertical-label" style="font-size: 22px"
      >request-<tspan dx="-1em" y="265">AnimationFrame</tspan></text>
  </g>
  <g class="fragment" data-fragment-index="2">
    <line x1="605" x2="605" y1="450" y2="540" class="connecting-line" />
    <rect x="582" y="250" width="50" height="200" class="style"/>
    <text x="604" y="265" class="vertical-label">Style</text>
  </g>
</svg>
<div class="code-block">
  <pre><code class="hljs js" data-trim>
  button.onclick = () => {
    const panel = document.createElement('div');
    ...
    panel.style.transform = 'scale(0)';
    requestAnimationFrame(() => {
      panel.style.transform = 'scale(1)';
    });
  };
  </code></pre>
</div>
<div class="popup fragment" data-fragment-index="2">
  <ul>
    <li><span class="prop-name">transform</span> は <span
              class="prop-value">scale(1)</span>.
    <li>前回の <span class="prop-name">transform</span> は... まだない.
  </ul>
</div>
<style>
#css-transitions-attempt-one-explanation > .code-block {
  display: flex;
  position: absolute;
  top: 20px;
  width: 100%;
}
#css-transitions-attempt-one-explanation > .code-block > pre {
  font-size: 15px;
  flex: 0 1 50%;
}
</style>
</section>

<section id="css-transitions-panel-attempt-two" class="panel-example"
  data-transition="fade">
<div class="side-by-side">
  <pre><code class="hljs js" data-trim data-noescape>
button.onclick = () => {
  // パネルを作る
  const panel = document.createElement('div');
  ...

  // アニメーションさせる
  panel.style.transform = 'scale(0)';
  panel.style.transition = 'transform .5s';
<span class="highlight">  requestAnimationFrame(() => {
    requestAnimationFrame(() => {
      panel.style.transform = 'scale(1)';
    });
  });</span>
};
  </code></pre>
  <div>
    <button class="button">Button</button>
  </div>
</div>
<script>
(() => {
  const button = document.querySelector(
    '#css-transitions-panel-attempt-two .button'
  );
  const parent
    = document.querySelector('#css-transitions-panel-attempt-two');

  button.onclick = () => {
    // If there is an existing panel, remove it
    const existingPanel = document.querySelector(
      '#css-transitions-panel-attempt-two .panel'
    );
    if (existingPanel) {
      existingPanel.remove();
      return;
    }

    // Create the panel
    const panel = document.createElement('div');
    panel.classList.add('panel');
    panel.textContent = 'ハロー！';
    parent.appendChild(panel);

    // Stretch in
    panel.style.transform = 'scale(0)';
    panel.style.transition = 'transform .5s';
    requestAnimationFrame(() => {
      requestAnimationFrame(() => {
        panel.style.transform = 'scale(1)';
      });
    });
  };
})();
</script>
</section>

<section id="css-transitions-attempt-two-explanation"
  class="frame-explanation" data-transition="fade">
<svg width="800" viewBox="39 100 1362 700" class="frame-timing">
  <g class="frame-outline">
    <rect x="40" y="250" width="400" height="200" />
    <rect x="520" y="250" width="400" height="200" />
    <rect x="1000" y="250" width="400" height="200" />
  </g>
  <g class="frame-label">
    <text x="240" y="490">Frame 1</text>
    <text x="720" y="490">Frame 2</text>
    <text x="1200" y="490">Frame 3</text>
  </g>
  <g>
    <rect x="40" y="250" width="50" height="200" class="style"/>
    <text x="63" y="265" class="vertical-label">Style</text>
    <rect x="91" y="250" width="50" height="200" class="layout"/>
    <text x="114" y="265" class="vertical-label">Layout</text>
    <rect x="142" y="250" width="50" height="200" class="painting"/>
    <text x="165" y="265" class="vertical-label">Painting</text>
  </g>
  <rect x="193" y="250" width="80" height="200" class="script"/>
  <text x="245" y="265" class="vertical-label">Script
    <tspan dx="-1em" y="265">(onclick)</tspan></text>
  <g class="fragment">
    <rect x="520" y="250" width="60" height="200" class="script"/>
    <text x="560" y="265" class="vertical-label" style="font-size: 22px"
      >request-<tspan dx="-1em" y="265">AnimationFrame</tspan></text>
  </g>
  <g class="fragment">
    <line x1="605" x2="605" y1="450" y2="510" class="connecting-line" />
    <rect x="582" y="250" width="50" height="200" class="style"/>
    <text x="604" y="265" class="vertical-label">Style</text>
    <text x="605" y="530" class="inline-note">transformの<tspan
      x="605" dy="1.2em">計算値→ &lsquo;scale(0)&rsquo;</tspan></text>
  </g>
  <g class="fragment">
    <rect x="1000" y="250" width="60" height="200" class="script"/>
    <text x="1040" y="265" class="vertical-label" style="font-size: 22px"
      >request-<tspan dx="-1em" y="265">AnimationFrame</tspan></text>
  </g>
  <g class="fragment">
    <line x1="1084" x2="1084" y1="450" y2="510" class="connecting-line" />
    <rect x="1062" y="250" width="50" height="200" class="style"/>
    <text x="1085" y="265" class="vertical-label">Style</text>
    <text x="1084" y="530" class="inline-note">transformの<tspan
      x="1084" dy="1.2em">計算値→ &lsquo;scale(1)&rsquo;</tspan></text>
  </g>
</svg>
<div class="code-block">
  <pre><code class="hljs js" data-trim>
  button.onclick = () => {
    ...
    panel.style.transform = 'scale(0)';
    requestAnimationFrame(() => {
      requestAnimationFrame(() => {
        panel.style.transform = 'scale(1)';
      });
    });
  };
  </code></pre>
</div>
<div class="popup fragment">
  <ul>
    <li><span class="prop-name">transform</span> は <span
              class="prop-value">scale(1)</span>.
    <li>前回の <span class="prop-name">transform</span> は
        <span class="prop-value">scale(0)</span>.
    <li><span class="action">&rArr; transitionを生成する！🎉</span>
  </ul>
</div>
<style>
.frame-timing .inline-note {
  text-anchor: middle;
  fill: var(--neutral-4);
  font-size: 25px;
}
#css-transitions-attempt-two-explanation > svg {
  margin-top: 180px;
}
#css-transitions-attempt-two-explanation > .code-block {
  display: flex;
  position: absolute;
  top: 10px;
  width: 100%;
}
#css-transitions-attempt-two-explanation > .code-block > pre {
  font-size: 15px;
  flex: 0 1 50%;
}
#css-transitions-attempt-two-explanation > .popup {
  top: -100px;
}
</style>
</section>

<section id="css-transitions-panel-attempt-three" class="panel-example"
  data-transition="fade-out">
<div class="side-by-side">
  <pre><code class="hljs js" data-trim data-noescape>
button.onclick = () => {
  // パネルを作る
  const panel = document.createElement('div');
  ...

  // アニメーションさせる
  panel.style.transform = 'scale(0)';
<span class="highlight">  getComputedStyle(panel).transform;</span>
  panel.style.transition = 'transform .5s';
  panel.style.transform = 'scale(1)';</span>
};
  </code></pre>
  <div>
    <button class="button">Button</button>
  </div>
</div>
<script>
(() => {
  const button = document.querySelector(
    '#css-transitions-panel-attempt-three .button'
  );
  const parent
    = document.querySelector('#css-transitions-panel-attempt-three');

  button.onclick = () => {
    // If there is an existing panel, remove it
    const existingPanel = document.querySelector(
      '#css-transitions-panel-attempt-three .panel'
    );
    if (existingPanel) {
      existingPanel.remove();
      return;
    }

    // Create the panel
    const panel = document.createElement('div');
    panel.classList.add('panel');
    panel.textContent = 'ハロー！';
    parent.appendChild(panel);

    // Stretch in
    panel.style.transform = 'scale(0)';
    getComputedStyle(panel).transform;
    panel.style.transition = 'transform .5s';
    panel.style.transform = 'scale(1)';
  };
})();
</script>
</section>

<section id="css-transitions-attempt-three-explanation"
  class="frame-explanation" data-transition="fade">
<svg width="800" viewBox="0 0 960 700" class="frame-timing">
  <g class="frame-outline">
    <rect x="40" y="250" width="400" height="200" />
    <rect x="520" y="250" width="400" height="200" />
  </g>
  <g class="frame-label">
    <text x="200" y="490">Frame 1</text>
    <text x="720" y="490">Frame 2</text>
  </g>
  <g>
    <rect x="40" y="250" width="50" height="200" class="style"/>
    <text x="63" y="265" class="vertical-label">Style</text>
    <rect x="91" y="250" width="50" height="200" class="layout"/>
    <text x="114" y="265" class="vertical-label">Layout</text>
    <rect x="142" y="250" width="50" height="200" class="painting"/>
    <text x="165" y="265" class="vertical-label">Painting</text>
  </g>
  <line x1="233" x2="233" y1="210" y2="250" class="connecting-line" />
  <rect x="193" y="250" width="80" height="200" class="script"/>
  <text x="245" y="265" class="vertical-label">Script
    <tspan dx="-1em" y="265">(onclick)</tspan></text>
  <g class="fragment">
    <rect x="274" y="250" width="50" height="200" class="style"/>
    <text x="297" y="265" class="vertical-label">Style</text>
    <g transform="translate(133)">
      <rect x="193" y="250" width="80" height="200" class="script"/>
      <text x="245" y="265" class="vertical-label"
        style="font-size: 25px">Script
        <tspan dx="-1em" y="265">(onclick) contd.</tspan></text>
    </g>
  </g>
  <g class="fragment">
    <line x1="299" x2="299" y1="450" y2="510" class="connecting-line" />
    <text x="299" y="530" class="inline-note smaller">transformの<tspan
      x="299" dy="1.2em">計算値→ &lsquo;scale(0)&rsquo;</tspan></text>
  </g>
  <g class="fragment">
    <line x1="546" x2="546" y1="450" y2="510" class="connecting-line" />
    <text x="546" y="530" class="inline-note smaller">transformの<tspan
      x="546" dy="1.2em">計算値→ &lsquo;scale(1)&rsquo;</tspan></text>
    <rect x="520" y="250" width="50" height="200" class="style"/>
    <text x="545" y="265" class="vertical-label">Style</text>
  </g>
</svg>
<div class="code-block">
  <pre><code class="hljs js" data-trim data-noescape>
  button.onclick = () => {
    const panel = document.createElement('div');
    ...
    panel.style.transform = 'scale(0)';
<span class="highlight">    getComputedStyle(panel).transform;</span>
    panel.style.transition = 'transform .5s';
    panel.style.transform = 'scale(1)';
  };
  </code></pre>
</div>
<div class="popup fragment">
  <ul>
    <li><span class="prop-name">transform</span> は <span
              class="prop-value">scale(1)</span>.
    <li>前回の <span class="prop-name">transform</span> は <span
                       class="prop-value">scale(0)</span>.
    <li><span class="action">&rarr; transitionを生成する！🎉</span>
  </ul>
</div>
<style>
#css-transitions-attempt-three-explanation > .code-block {
  display: flex;
  position: absolute;
  top: 20px;
  width: 100%;
}
#css-transitions-attempt-three-explanation > .code-block > pre {
  font-size: 15px;
  flex: 0 1 50%;
}
#css-transitions-attempt-three-explanation > .popup {
  top: -100px;
}
.frame-timing .inline-note.smaller {
  font-size: 22px;
}
</style>
</section>

<section id="style-change-tips">
<h2>注意点</h2>
<ul>
  <li>以下の場合は計算されたスタイルはない&hellip;
    <ul>
      <li><code>createElement</code>の直後
      <li><code>display: none</code>
    </ul>
  <li><code>getComputedStyle(elem)</code>だけだと、スタイルの算出は走らない！❌
    <ul>
      <li>&rarr; <code>getComputedStyle(elem).<em>&lt;property&gt;</em></code>👍
    </ul>
  <li>場合によっては<code>getComputedStyle</code>は重い
</ul>
<style>
#style-change-tips ul {
  font-size: 35px;
}
#style-change-tips ul code {
  color: var(--green-dark);
  background: var(--green-10);
  border-radius: .5em;
  padding: 1px 15px;
}
#style-change-tips > ul > li {
  margin-top: 1em;
}
</style>
</section>

<section id="css-transitions-react" class="panel-example"
  data-transition="fade-out">
<div class="side-by-side">
  <pre><code class="hljs jsx" data-trim data-noescape>
const PopupButton = () => {
  const [isShowing, setIsShowing] = React.useState(false);

  const panelRef = React.useRef(null);
<span class="highlight">  React.useLayoutEffect(() => {
    panelRef.current.style.transform = 'scale(1)';
  }, [isShowing, panelRef.current]);</span>

  const buttonClick = React.useCallback(() => {
    setIsShowing(!isShowing);
  }, [isShowing]);

  return (<>
    &lt;button onClick={buttonClick} />
    {isShowing ? (
      &lt;div ref={panelRef}
<span class="highlight">        style={{ transition: 'transform .5s', transform: 'scale(0)' }}></span>
        ハロー！
      &lt;/div>
    ) : null}
  &lt;/>);
};
  </code></pre>
  <div class="panel-container">
  </div>
</div>
<script>
(() => {
  const PopupButton = () => {
    const [isShowing, setIsShowing] = React.useState(false);

    const panelRef = React.useRef(null);
    React.useLayoutEffect(() => {
      if (panelRef.current) {
        panelRef.current.style.transform = 'scale(1)';
      }
    }, [isShowing, panelRef.current]);

    const buttonClick = React.useCallback(() => {
      setIsShowing(!isShowing);
    }, [isShowing]);

    const button = React.createElement(
      'button',
      { onClick: buttonClick, key: 'button', className: 'button' },
      'Button'
    );
    const children = [button];
    if (isShowing) {
      const panel = React.createElement('div', {
        ref: panelRef,
        className: 'panel',
        key: 'panel',
        style: { transition: 'transform .5s', transform: 'scale(0)' },
      }, 'ハロー！');
      children.push(panel);
    }

    const fragment = React.createElement(React.Fragment, null, children);

    return fragment;
  };

  const container = document.querySelector(
    '#css-transitions-react .panel-container'
  );
  ReactDOM.render(React.createElement(PopupButton), container);
})();
</script>
<style>
#css-transitions-react pre {
  font-size: 15px;
}
</style>
</section>

<section id="css-transitions-react-fixed" class="panel-example"
  data-transition="fade-out">
<div class="side-by-side">
  <pre><code class="hljs jsx" data-trim data-noescape>
const PopupButton = () => {
  const [isShowing, setIsShowing] = React.useState(false);

  const panelRef = React.useRef(null);
  React.useLayoutEffect(() => {
<span class=highlight>    getComputedStyle(panelRef.current).transform;</span>
    panelRef.current.style.transform = 'scale(1)';
  }, [isShowing, panelRef.current]);

  const buttonClick = React.useCallback(() => {
    setIsShowing(!isShowing);
  }, [isShowing]);

  return (<>
    &lt;button onClick={buttonClick} />
    {isShowing ? (
      &lt;div ref={panelRef}
        style={{ transition: 'transform .5s', transform: 'scale(0)' }}>
        ハロー！
      &lt;/div>
    ) : null}
  &lt;/>);
};
  </code></pre>
  <div class="panel-container">
  </div>
</div>
<script>
(() => {
  const PopupButton = () => {
    const [isShowing, setIsShowing] = React.useState(false);

    const panelRef = React.useRef(null);
    React.useLayoutEffect(() => {
      if (panelRef.current) {
        getComputedStyle(panelRef.current).transform;
        panelRef.current.style.transform = 'scale(1)';
      }
    }, [isShowing, panelRef.current]);

    const buttonClick = React.useCallback(() => {
      setIsShowing(!isShowing);
    }, [isShowing]);

    const button = React.createElement(
      'button',
      { onClick: buttonClick, key: 'button', className: 'button' },
      'Button'
    );
    const children = [button];
    if (isShowing) {
      const panel = React.createElement('div', {
        ref: panelRef,
        className: 'panel',
        key: 'panel',
        style: { transition: 'transform .5s', transform: 'scale(0)' },
      }, 'ハロー！');
      children.push(panel);
    }

    const fragment = React.createElement(React.Fragment, null, children);

    return fragment;
  };

  const container = document.querySelector(
    '#css-transitions-react-fixed .panel-container'
  );
  ReactDOM.render(React.createElement(PopupButton), container);
})();
</script>
<style>
#css-transitions-react-fixed pre {
  font-size: 15px;
}
</style>
</section>

<section id="transitions-can-disappear" data-background="var(--green-10)">
  <h2>② CSS Transitionsに<br><span class=highlight>終わらない</span>こともある</h2>
<style>
#transitions-can-disappear .highlight {
  color: var(--red-6);
  text-shadow: var(--red-2) 0px 3px 3px;
}
</style>
</section>

<section id="css-transitions-hiding" class="panel-example"
  data-transition="fade-out">
<div class="side-by-side">
  <pre><code class="hljs js" data-trim data-noescape>
button.onclick = () =&gt; {
  // … パネルが表示されていれば、削除する。
<span class="highlight">  panel.remove();</span>
};
  </code></pre>
  <div>
    <button class="button">Button</button>
  </div>
</div>
<script>
(() => {
  const button = document.querySelector('#css-transitions-hiding .button');
  const parent = document.querySelector('#css-transitions-hiding');

  button.onclick = () => {
    // If there is an existing panel, remove it
    const existingPanel = document.querySelector(
      '#css-transitions-hiding .panel'
    );
    if (existingPanel) {
      existingPanel.remove();
      return;
    }

    // Create the panel
    const panel = document.createElement('div');
    panel.classList.add('panel');
    panel.textContent = 'ハロー！';
    parent.appendChild(panel);

    // Stretch in
    panel.style.transform = 'scale(0)';
    getComputedStyle(panel).transform;
    panel.style.transition = 'transform .5s';
    panel.style.transform = 'scale(1)';
  };
})();
</script>
</section>

<section id="css-transitions-hiding-with-transition" class="panel-example"
  data-transition="fade-in">
<div class="side-by-side">
  <pre><code class="hljs js" data-trim data-noescape>
button.onclick = () =&gt; {
  // … パネルが表示されていれば、削除する。
<span class="highlight">  panel.style.transform = 'scale(0)';
  panel.addEventListener('transitionend', () =&gt; {
    panel.remove();
  });</span>
};
  </code></pre>
  <div>
    <button class="button">Button</button>
  </div>
</div>
<script>
(() => {
  const button = document.querySelector(
    '#css-transitions-hiding-with-transition .button'
  );
  const parent = document.querySelector(
    '#css-transitions-hiding-with-transition'
  );

  button.onclick = () => {
    // If there is an existing panel, remove it
    const existingPanel = document.querySelector(
      '#css-transitions-hiding-with-transition .panel'
    );
    if (existingPanel) {
      existingPanel.style.transform = 'scale(0)';
      existingPanel.addEventListener('transitionend', () => {
        existingPanel.remove();
      });
      return;
    }

    // Create the panel
    const panel = document.createElement('div');
    panel.classList.add('panel');
    panel.textContent = 'ハロー！';
    parent.appendChild(panel);

    // Stretch in
    panel.style.transform = 'scale(0)';
    getComputedStyle(panel).transform;
    panel.style.transition = 'transform .5s';
    panel.style.transform = 'scale(1)';
  };
})();
</script>
</section>

<section id="transitions-can-be-canceled">
<h2>もしtransitionの再生中に&hellip;</h2>
<ul>
  <li>要素が <code>display:none</code> になったら？
  <li>要素が再生成されたら？
  <li><code>transition-property</code> の計算値が変わったら？
  <li>要素が削除されたら？
</ul>
<p class="lookout fragment">
transitionは<em>キャンセル</em>されて<br>
<code>transitionend</code> は発火されない！
</p>
<style>
#transitions-can-be-canceled code {
  color: var(--green-dark);
  background: var(--green-10);
  border-radius: .5em;
  padding: 1px 15px;
}
#transitions-can-be-canceled .lookout {
  background: var(--green);
  padding: 25px;
  color: white;
  border-radius: 50px;
}
#transitions-can-be-canceled .lookout em {
  padding-left: 0.3em;
  padding-right: 0.3em;
  font-style: normal;
  font-weight: 600;
  color: var(--red-8);
  text-shadow: var(--red-2) 0px 2px 2px;
}
#transitions-can-be-canceled .lookout code {
  color: var(--red-6);
  font-weight: bold;
}
</style>
</section>

<section id="lots-of-bugs">
<div class="container fragment">
  <img src="img/bug683696.png" width="800" height="254">
  <img src="img/bug1206913.png" width="800" height="204">
  <img src="img/bug1118361.png" width="800" height="192">
  <img src="img/bug1075333.png" width="800" height="187">
  <img src="img/bug1059650.png" width="800" height="192">
  <div class=labels>
    <span>1) Transitionが生成されていない</span>
    <span>2) Transitionが終わらない</span>
  </div>
</div>
<style>
#lots-of-bugs img {
  border-width: 0;
  box-shadow: none;
  opacity: 0;
  transition: transform 0.5s, opacity 0.7s;
}
#lots-of-bugs.present img {
  opacity: 1;
}
#lots-of-bugs.future img,
#lots-of-bugs .container.visible img {
  transition-property: transform;
}
#lots-of-bugs img:nth-child(1) {
  margin-left: -20px;
  transition-delay: 0s, 0.5s;
}
#lots-of-bugs img:nth-child(2) {
  margin-top: -180px;
  margin-left: 60px;
  transition-delay: 0s, 1.5s;
}
#lots-of-bugs img:nth-child(3) {
  margin-top: -120px;
  margin-left: -70px;
  transition-delay: 0s, 2.5s;
}
#lots-of-bugs img:nth-child(4) {
  margin-top: -120px;
  margin-left: 40px;
  transition-delay: 0s, 3.3s;
}
#lots-of-bugs img:nth-child(5) {
  margin-top: -110px;
  margin-left: -40px;
  transition-delay: 0s, 3.8s;
}
#lots-of-bugs .container {
  visibility: visible;
  opacity: 1;
}
#lots-of-bugs .container .labels {
  opacity: 0;
  transition: opacity 0.5s;
  display: flex;
}
#lots-of-bugs .container .labels span {
  color: var(--red-4);
  margin-top: -200px;
  font-weight: 500;
}
#lots-of-bugs .container.visible img:nth-child(1) {
  transform: scale(0.5) translate(-450px);
}
#lots-of-bugs .container.visible img:nth-child(2) {
  transform: scale(0.5) translate(-460px);
}
#lots-of-bugs .container.visible img:nth-child(3) {
  transform: scale(0.5) translate(-450px, -50px);
}
#lots-of-bugs .container.visible img:nth-child(4) {
  transform: scale(0.5) translate(450px, -500px);
}
#lots-of-bugs .container.visible img:nth-child(5) {
  transform: scale(0.5) translate(480px, -550px);
}
#lots-of-bugs .container.visible .labels {
  opacity: 1;
  transition-delay: 0.4s;
}
</style>
</section>

<section id="css-transitions-canceling-react" class="panel-example"
  data-transition="fade-out">
<div class="side-by-side">
  <pre><code class="hljs jsx" data-trim data-noescape>
//...

const buttonClick = React.useCallback(() => {
  if (panelState === 'showing') {
    setPanelState('hiding');
<span class=highlight>    panelRef.current.addEventListener('transitionend', () => {
      setPanelState('hidden');
    }, { once: true });</span>
  } else {
    setPanelState('showing');
  }
}, [panelState]);

// ...
  </code></pre>
  <div class="panel-container">
  </div>
</div>
<script>
(() => {
  const PopupButton = () => {
    const [panelState, setPanelState] = React.useState('hidden');

    const panelRef = React.useRef(null);
    React.useLayoutEffect(() => {
      switch (panelState) {
        case 'showing':
          getComputedStyle(panelRef.current).transform;
          panelRef.current.style.transform = 'scale(1)';
          break;

        case 'hiding':
          getComputedStyle(panelRef.current).transform;
          panelRef.current.style.transform = 'scale(0)';
          break;
      }
    }, [panelState, panelRef.current]);

    const buttonClick = React.useCallback(() => {
      if (panelState === 'showing') {
        setPanelState('hiding');
        panelRef.current.addEventListener('transitionend', () => {
          setPanelState('hidden');
        }, { once: true });
      } else {
        setPanelState('showing');
      }
    }, [panelState]);

    const button = React.createElement(
      'button',
      { onClick: buttonClick, key: 'button', className: 'button' },
      'Button'
    );
    const children = [button];
    if (panelState !== 'hidden') {
      const panel = React.createElement('div', {
        ref: panelRef,
        className: 'panel',
        key: 'panel',
        style: { transition: 'transform 1s', transform: 'scale(0)' },
      }, 'ハロー！');
      children.push(panel);
    }

    const fragment = React.createElement('div', null, children);

    return fragment;
  };

  const container = document.querySelector(
    '#css-transitions-canceling-react .panel-container'
  );
  ReactDOM.render(React.createElement(PopupButton), container);
})();
</script>
<style>
#css-transitions-canceling-react pre {
  font-size: 20px;
}
</style>
</section>

<section id="lots-of-events">
<h2>新しいイベント！</h2>
<ul>
  <li><code>transitionrun</code>
    <p class=explanation>&rarr; transitionが生成された 🆕
    <p class=explanation>&rarr; <code>transitionend</code>を待ってもオッケー 🙆‍♂️</p>
  <li><code>transitioncancel</code>
    <p class=explanation>&rarr; 要素が消えた🗑️
    <span style="font-size: smaller">（削除されたり、再生成されたり、
      <code>display:none</code>になったり）</span></p>
    <p class=explanation>&rarr; <code>transitionend</code>を待たない方が良い ❌</p>
  <li><code>animationcancel</code>
    <span class=explanation>（<code>transitioncancel</code>と同様）</span>
</ul>
<style>
#lots-of-events code {
  color: var(--green);
  font-weight: 600;
  background: var(--green-10);
  border-radius: 10px;
  padding-left: 10px;
  padding-right: 10px;
}
#lots-of-events .explanation {
  font-size: 30px;
}
</style>
</section>

<section id="hows-your-event-game">
<h2><code>transitioncancel</code>たち</h2>
<ul class="logo-list">
  <li><img class="logo" src="img/firefox-logo.svg"><span>53+</span>
  <li><img class="logo" src="img/chrome-logo.svg"><span>74+</span>
    <span class=fineprint>No <code>animationcancel</code></span>
  <li class=exp-support><img class="logo" src="img/technology-preview.png"><span>Tech Preview</span>
  <li><img class="logo" src="img/edgium.png"><span class=maru>〇</span>
    <span class=fineprint>No <code>animationcancel</code></span>
</ul>
<style>
#hows-your-event-game .logo-list {
  margin-top: 50px;
}
#hows-your-event-game code {
  color: var(--green);
  background: var(--green-10);
  border-radius: 10px;
  padding-left: 10px;
  padding-right: 10px;
}
#hows-your-event-game .logo-list .fineprint {
  display: block;
  margin-top: 10px;
  font-size: 20px;
  line-height: 1.2;
}

/* Re-useable parts */
.reveal .logo-list {
  line-height: 1.5;
  list-style: none;
  display: flex;
  justify-content: space-around;
}
.reveal .logo-list li {
  flex-basis: 100px;
  display: flex;
  flex-direction: column;
  align-items: center;
  text-align: center;
  font-size: 35px;
  line-height: 1;
}
.reveal .logo-list .logo {
  width: 100px;
  /* I have no idea how this works but it stops the Edgium logo from being
     squashed vertically. */
  max-width: 100px;
  height: 100px;
  margin: 0;
  margin-bottom: 0.5em;
  border: none;
  box-shadow: none;
  background: transparent;
  vertical-align: text-bottom;
}
.reveal .logo-list .batsu {
  color: hsl(354, 85%, 44%);
  font-weight: bold;
}
.reveal .logo-list .maru {
  color: var(--green);
  font-weight: bold;
}
.reveal .logo-list .no-support {
  filter: grayscale(100%);
  opacity: 0.4;
}
.reveal .logo-list .exp-support {
  opacity: 0.6;
}
</style>
</section>

<section id="web-animations-is-here" data-background="var(--green-10)">
  <h2>③ <span class=highlight>Web Animations API</span><br>
    を使ってみて</h2>
<style>
#web-animations-is-here .highlight {
  color: var(--red-6);
  text-shadow: var(--red-2) 0px 3px 3px;
}
</style>
</section>

<section id="web-animations-button" class="panel-example">
<h2>Element.animate()</h2>
<div class="side-by-side">
  <pre><code class="hljs js" data-trim data-noescape>
button.onclick = () => {
  // パネルを作る
  const panel = document.createElement('div');
  panel.classList.add('panel');
  panel.textContent = 'ハロー！';
  parent.appendChild(panel);

  // アニメーションさせる
<div class=replace><span class="highlight" data-fragment-index=0>  panel.style.transform = 'scale(0)';
  getComputedStyle(panel).transform;
  panel.style.transition = 'transform .5s';
  panel.style.transform = 'scale(1)';</span>
<span class="highlight fragment ontop" data-fragment-index=1>  panel.animate(
    { transform: ['scale(0)', 'scale(1)'] },
    { duration: 500, easing: 'ease' }
  );</span></div>};
  </code></pre>
  <div>
    <button class="button">Button</button>
  </div>
</div>
<script>
(() => {
  const button = document.querySelector('#web-animations-button .button');
  const parent = document.querySelector('#web-animations-button');

  button.onclick = () => {
    // If there is an existing panel, remove it
    const existingPanel = document.querySelector(
      '#web-animations-button .panel'
    );
    if (existingPanel) {
      existingPanel.remove();
      return;
    }

    // Create the panel
    const panel = document.createElement('div');
    panel.classList.add('panel');
    panel.textContent = 'ハロー！';
    parent.appendChild(panel);

    // Stretch in
    panel.animate(
      {
        transform: ['scale(0)', 'scale(1)'],
      },
      { duration: 500, easing: 'ease' }
    );
  };
})();
</script>
<style>
#web-animations-button .replace {
  position: relative;
}
#web-animations-button .fragment.ontop {
  position: absolute;
  top: 0;
}
</style>
</section>

<section id="web-animations-meets-react" class="panel-example"
  data-transition="fade-out">
<h2>Animation.finished</h2>
<div class="side-by-side">
  <pre><code class="hljs jsx" data-trim data-noescape>
React.useLayoutEffect(() =&gt; {
  let animation;
  if (panelState === 'showing') {
    animation = panelRef.current.animate(
      { transform: ['scale(0)', 'scale(1)'] },
      { duration: 500, easing: 'ease' }
    );
  } else if (panelState === 'hiding') {
    animation = panelRef.current.animate(
      { transform: ['scale(1)', 'scale(0)'] },
      { duration: 500, easing: 'ease' }
    );
    // animationがキャンセルされたらfinishedがrejectされる
<span class="highlight fragment">    animation.finished.then(() =&gt; {
      setPanelState('hidden');
    });</span>
  }
  return () =&gt; {
    if (animation) { animation.cancel() }
  };
}, [panelState, panelRef.current]);
  </code></pre>
  <div class="panel-container">
  </div>
</div>
<script>
(() => {
  const PopupButton = () => {
    const [panelState, setPanelState] = React.useState('hidden');

    const panelRef = React.useRef(null);
    React.useLayoutEffect(() => {
      let animation;
      if (panelState === 'showing') {
        animation = panelRef.current.animate(
          { transform: ['scale(0)', 'scale(1)'] },
          { duration: 500, easing: 'ease' }
        );
      } else if (panelState === 'hiding') {
        animation = panelRef.current.animate(
          { transform: ['scale(1)', 'scale(0)'] },
          { duration: 500, easing: 'ease' }
        );
        animation.finished.then(() => {
          setPanelState('hidden');
        }).catch(() => { /* Ignore */ });
      }
      return () => {
        if (animation) {
          animation.cancel();
        }
      };
    }, [panelState, panelRef.current]);

    const buttonClick = React.useCallback(() => {
      if (panelState === 'showing') {
        setPanelState('hiding');
      } else {
        setPanelState('showing');
      }
    }, [panelState]);

    const button = React.createElement(
      'button',
      { onClick: buttonClick, key: 'button', className: 'button' },
      'Button'
    );
    const children = [button];
    if (panelState !== 'hidden') {
      const panel = React.createElement('div', {
        ref: panelRef,
        className: 'panel',
        key: 'panel',
      }, 'ハロー！');
      children.push(panel);
    }

    const fragment = React.createElement('div', null, children);

    return fragment;
  };

  const container = document.querySelector(
    '#web-animations-meets-react .panel-container'
  );
  ReactDOM.render(React.createElement(PopupButton), container);
})();
</script>
<style>
#web-animations-meets-react pre {
  font-size: 15px;
}
#web-animations-meets-react .fragment {
  opacity: 1;
  visibility: visible;
  background-color: transparent;
}
#web-animations-meets-react .fragment.highlight.current-fragment {
  background-color: var(--green-10);
}
</style>
</section>

<section id="a-more-complex-example" class="app-frame">
<iframe width="400" height="600" src="notes/notes.html"></iframe>
</section>

<section id="css-transitions-with-web-animations" class="panel-example"
  data-transition="fade-in">
<h2>CSS Transitions ♡ Web Animations</h2>
<pre><code class="hljs js" data-trim data-noescape>
// transitionend
button.onclick = () =&gt; {
  panel.style.transform = 'scale(0)';
  panel.addEventListener('transitionend', () =&gt; {
    panel.remove();
  });
};
</code></pre>
<pre class=fragment><code class="hljs js" data-trim data-noescape>
// Web Animationsのfinished Promise
button.onclick = () =&gt; {
  panel.style.transform = 'scale(0)';
<span class="fragment highlight">  const transition = panel.getAnimations()[0];</span>
<span class="fragment highlight">  transition.finished.then(() => {
    panel.remove();
  });</span>
});
</code></pre>
<style>
#css-transitions-with-web-animations span.fragment.highlight {
  opacity: 1;
  visibility: visible;
  background-color: transparent;
}
#css-transitions-with-web-animations span.fragment.highlight.current-fragment {
  background-color: var(--green-10);
}
</style>
</section>

<section id=colors-gone-wrong>
<div class="color-transition fragment">
  <div class=red>
    <div class=sample></div><span class=label>rgb(255, 0, 0)</span>
  </div>
  <div class=arrow>→</div>
  <div class=midpoint>
    <div class="sample hide"></div>
    <div class="sample reveal"></div>
    <span class="label hide">rgb(?, ?, ?)</span>
    <span class="label reveal">rgb(128, 64, 0)</span>
  </div>
  <div class=arrow>→</div>
  <div class=green>
    <div class=sample></div><span class=label>rgb(0, 128, 0)</span>
  </div>
</div>
<div class="transition-demo fragment">
  <div class=sample></div>
  <div class=label>😧</div>
</div>
<style>
#colors-gone-wrong .color-transition.fragment {
  opacity: 1;
  visibility: visible;
}
#colors-gone-wrong .color-transition .midpoint .sample.reveal {
  background-color: rgb(128, 64, 0);
}
#colors-gone-wrong .color-transition .reveal,
#colors-gone-wrong .color-transition .hide {
  transition: opacity 0.5s;
}
#colors-gone-wrong .color-transition .sample.reveal {
  opacity: 0;
  margin-top: -110px;
}
#colors-gone-wrong .color-transition .label.reveal {
  opacity: 0;
  margin-top: -40px;
}
#colors-gone-wrong .color-transition.visible .reveal {
  opacity: 1;
}
#colors-gone-wrong .color-transition.visible .hide {
  opacity: 0;
}
#colors-gone-wrong .transition-demo {
  margin-top: 50px;
}
#colors-gone-wrong .transition-demo .sample {
  animation-name: colors-gone-wrong;
}
@keyframes colors-gone-wrong {
  from { background-color: rgb(255, 0, 0); }
  10% { background-color: rgb(255, 0, 0); }
  90% { background-color: rgb(0, 128, 0); }
  to { background-color: rgb(0, 128, 0); }
}

/* Re-usable parts */
.reveal .color-transition {
  display: flex;
  justify-content: center;
}
.reveal .color-transition .sample {
  width: 100px;
  height: 100px;
  margin-left: auto;
  margin-right: auto;
  border: 5px solid var(--neutral-1);
  border-radius: 100px;
}
.reveal .color-transition .red .sample {
  background-color: rgb(255, 0, 0);
}
.reveal .color-transition .green .sample {
  background-color: rgb(0, 128, 0);
}
.reveal .color-transition .label {
  display: block;
  margin-top: 20px;
  font-size: 30px;
  text-align: center;
}
.reveal .color-transition .arrow {
  font-size: 80px;
  font-weight: bold;
}

.reveal .transition-demo .sample {
  width: 150px;
  height: 150px;
  margin-left: auto;
  margin-right: auto;
  border: 10px solid var(--neutral-1);
  border-radius: 200px;
  animation-duration: 2s;
  animation-timing-function: linear;
  animation-iteration-count: infinite;
  animation-direction: alternate;
}
.reveal .transition-demo .label {
  margin-top: 20px;
  font-size: 40px;
  text-align: center;
}
</style>
</section>

<section id=colors-with-hsl>
<div class=color-transition>
  <div class=red>
    <div class=sample></div><span class=label>hsl(0, 100%, 50%)</span>
  </div>
  <div class=arrow>→</div>
  <div class=hslmidpoint>
    <div class=sample></div><span class=label>hsl(60, 100%, 37.5%)</span>
  </div>
  <div class=arrow>→</div>
  <div class=green>
    <div class=sample></div><span class=label>hsl(120, 100%, 25%)</span>
  </div>
</div>
<div class="transition-demo fragment">
  <div class=sample></div>
  <div class=label>❓</div>
</div>
<style>
#colors-with-hsl .color-transition .hslmidpoint .sample {
  background-color: hsl(60, 100%, 37.5%);
}
#colors-with-hsl .color-transition .label {
  font-size: 25px;
}
#colors-with-hsl .transition-demo {
  margin-top: 50px;
}
#colors-with-hsl .transition-demo .sample {
  animation-name: colors-with-hsl;
}

@keyframes colors-with-hsl {
  from { background-color: hsl(0, 100%, 50%); }
  10% { background-color: hsl(0, 100%, 50%); }
  30% { background-color: hsl(30, 100%, 43.75%); }
  50% { background-color: hsl(60, 100%, 37.5%); }
  70% { background-color: hsl(90, 100%, 31.25%); }
  90% { background-color: hsl(120, 100%, 25%); }
  to { background-color: hsl(120, 100%, 25%); }
}
</style>
</section>

<section id="hacking-colors">
<h2><code>CSSTransition.setKeyframes()</code></h2>
<pre><code class="hljs js" data-trim data-noescape>
document.addEventListener(<span class="highlight fragment">'transitionrun'</span>, evt =&gt; {
  <span class="highlight fragment">if (evt.propertyName !== 'fill') {</span>
    return;
  }

<span class="highlight fragment">  const transition = evt.target
    .getAnimations()
    .find(animation =&gt; animation.transitionProperty === 'fill');</span>

  <span class="highlight fragment">const keyframes = transition.effect.getKeyframes();</span>
  const hslKeyframes = generateHslKeyframes(
    keyframes[0].fill,
    keyframes[1].fill
  );

  <span class="highlight fragment">transition.effect.setKeyframes(hslKeyframes);</span>
});
</code></pre>
<style>
#hacking-colors h2 {
  font-size: 40px;
}
#hacking-colors pre code {
  font-size: 19px;
  max-height: none;
}
#hacking-colors .fragment.highlight {
  opacity: 1;
  visibility: visible;
  background-color: transparent;
}
#hacking-colors .fragment.highlight.current-fragment {
  background-color: var(--green-10);
}
</style>
</section>

<section id="color-wheelies">
<svg class="wheelie" viewBox="-10 -10 464.4 516">
  <!-- Main circle -->
  <circle id="main" fill="red" cx="221.7" cy="250.5" r="114"
    stroke="#222" stroke-width="10"/>
  <!-- Swatches -->
  <circle class="swatch -selected" fill="hsl(0, 90%, 50%)"
    cx="221.7" cy="53.5" r="53"/>
  <circle class="swatch" fill="hsl(60deg, 90%, 50%)"
    cx="53.5" cy="151.18" r="53"/>
  <circle class="swatch" fill="hsl(120deg, 80%, 50%)"
    cx="53.5" cy="345.7" r="53"/>
  <circle class="swatch" fill="hsl(180deg, 90%, 50%)"
    cx="221.7" cy="442.5" r="53"/>
  <circle class="swatch" fill="hsl(240deg, 80%, 50%)"
    cx="390.9" cy="345.7" r="53"/>
  <circle class="swatch" fill="hsl(300deg, 80%, 50%)"
    cx="390.9" cy="151.18" r="53"/>
</svg>
<style>
#color-wheelies .wheelie {
  width: 400px;
}
#color-wheelies .swatch {
  stroke: #222;
  stroke-width: 10px;
  stroke-opacity: 0;
  stroke-linecap: round;
  stroke-dasharray: 10 20;
  cursor: pointer;
}
#color-wheelies .swatch:hover {
  stroke-opacity: 0.5;
  transition: stroke-opacity .5s;
}
#color-wheelies .swatch.-selected {
  stroke-opacity: 1;
}
#color-wheelies #main {
  transition: fill 1s;
}
</style>
<script>
(() => {
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', setupSwatches);
  } else {
    setupSwatches();
  }

  function setupSwatches() {
    const main = document.querySelector('#color-wheelies #main');
    const swatches = document.querySelectorAll('#color-wheelies .swatch');

    for (const swatch of swatches) {
      swatch.addEventListener('click', evt => {
        // Remove selection from any existing swatch
        const selected = evt.target.parentElement.querySelector(
          '.swatch.-selected'
        );
        if (selected && selected !== evt.target) {
          selected.classList.remove('-selected');
        }

        // Add to this swatch
        evt.target.classList.add('-selected');

        // Set target color
        const targetColor = getComputedStyle(evt.target).fill;
        main.style.fill = targetColor;
      });
    }
  }

  document
    .getElementById('color-wheelies')
    .addEventListener('transitionrun', evt => {
      if (evt.propertyName !== 'fill') {
        return;
      }

      const transition = evt.target
        .getAnimations()
        .find(animation => animation.transitionProperty === 'fill');
      if (!transition) {
        return;
      }

      const keyframes = transition.effect.getKeyframes();
      const start = keyframes[0].fill;
      const end = keyframes[1].fill;

      // Implementations currently differ with regards to whether the easing
      // goes on the keyframes or on the effect. Ultimately it should go on the
      // effect but for now handle the case where it is on the keyframes by
      // moving it to the effect.
      if (keyframes[0].easing !== 'linear') {
        transition.effect.updateTiming({ easing: keyframes[0].easing });
      }

      const hslKeyframes = generateHslKeyframes(start, end);
      transition.effect.setKeyframes(hslKeyframes);
    });

  function generateHslKeyframes(start, end) {
    // From https://css-tricks.com/converting-color-spaces-in-javascript/
    const toRgba = color => {
      const sep = color.indexOf(",") > -1 ? "," : " ";
      return color.substr(4).split(")")[0].split(sep);
    };

    const toHsl = rgb => {
      const r = rgb[0] / 255;
      const g = rgb[1] / 255;
      const b = rgb[2] / 255;

      const cmin = Math.min(r,g,b);
      const cmax = Math.max(r,g,b);
      const delta = cmax - cmin;

      let h;

      if (delta == 0) {
        h = 0;
      } else if (cmax == r) {
        h = ((g - b) / delta) % 6;
      } else if (cmax == g) {
        h = (b - r) / delta + 2;
      } else {
        h = (r - g) / delta + 4;
      }
      h = Math.round(h * 60);

      if (h < 0) {
        h += 360;
      }

      let l = (cmax + cmin) / 2;
      let s = delta == 0 ? 0 : delta / (1 - Math.abs(2 * l - 1));

      l = +(l * 100);
      s = +(s * 100);

      return [h, s, l];
    };

    const startHsl = toHsl(toRgba(start));
    const endHsl = toHsl(toRgba(end));

    const numKeyframes = 11;
    const keyframes = [];
    for (let i = 0; i < numKeyframes; i++) {
      const p = i / (numKeyframes - 1);
      const interpolate = (a, b) => (1 - p) * a + p * b;

      // This is some very rough shortest path thing to make sure that instead of
      // animating from 240deg to 0deg we go from -60deg to 0deg.
      let startH = startHsl[0];
      let endH = endHsl[0];
      if (startH - endH > 180) {
        startH -= 360;
      } else if (endH - startH > 180) {
        endH -= 360;
      }

      const h = interpolate(startH, endH);
      const s = interpolate(startHsl[1], endHsl[1]);
      const l = interpolate(startHsl[2], endHsl[2]);
      const fill = `hsl(${h.toFixed(1)}, ${s.toFixed(1)}%, ${l.toFixed(1)}%)`;

      keyframes.push({
        offset: i / (numKeyframes - 1),
        fill,
      });
    }

    return keyframes;
  }
})();
</script>
</section>

<!-- XXX Note example -->

<section id="web-animations-support">
<h2>Web Animations</h2>
<table class=support-table>
  <tr>
    <th></th>
    <th><img class=logo src="img/firefox-logo.svg"></th>
    <th><img class=logo src="img/chrome-logo.svg"></th>
    <th><img class=logo src="img/safari-logo.svg"></th>
  </tr>
  <tr>
    <td>Element.animate()</td>
    <td class=ok>48+</td>
    <td class=ok>36+</td>
    <td class=nearly>3月？</td>
  </tr>
  <tr>
    <td>getAnimations()</td>
    <td class=nearly>Nightly, 75+</td>
    <td class=nearly>Canary, 4月？</td>
    <td class=nearly>3月？</td>
  </tr>
</table>
<style>
#web-animations-support .support-table {
  font-size: 30px;
}
#web-animations-support .support-table tr:nth-child(2) {
  border-bottom: var(--green-dark) dotted 2px;
}
#web-animations-support .support-table th,
#web-animations-support .support-table td {
  border: none;
}
#web-animations-support .support-table th:not(:first-child),
#web-animations-support .support-table td:not(:first-child) {
  text-align: center;
}
#web-animations-support .support-table td.ok {
  background: var(--green-10);
}
#web-animations-support .support-table td.nearly {
  background: hsl(48, 95%, 90%);
}
#web-animations-support .support-table .logo {
  width: 100px;
  height: 100px;
  margin: 0;
  margin-bottom: 10px;
  border: none;
  box-shadow: none;
  background: transparent;
  vertical-align: text-bottom;
}
</style>
</section>

<section id="react-router-considered-harmful" data-background="var(--green-10)">
  <h2><span class=omake><span>おまけ</span></span>アニメーションできる<br>ように<span class=highlight>DOMを常備する</span></h2>
<style>
#react-router-considered-harmful .omake {
  display: inline-flex;
  flex-direction: column;
  justify-content: center;
  vertical-align: top;
  height: 1em;

  padding: 0 .5em;
  margin-right: .3em;

  color: var(--red-3);
  background: var(--red-10);
  border-radius: .5em;
  box-shadow: hsla(350, 94%, 28%, 60%) 0px 3px 3px;
}
#react-router-considered-harmful .omake > * {
  font-size: 60%;
}
#react-router-considered-harmful .highlight {
  color: var(--red-6);
  text-shadow: var(--red-2) 0px 3px 3px;
}
</style>
</section>

<section id="single-page-apps" data-transition="fade-out">
<h2>Single page apps</h2>
<pre><code class="hljs js" data-trim data-noescape>
react.render(
  &lt;Router&gt;
    &lt;Route <span class=hljs-attr>exact</span> <span
                    class=hljs-attr>path</span>=<span
                    class=hljs-string>"/"</span> <span
                    class=hljs-attr>component</span>={<span
                    class=hljs-literal>Photos</span>} /&gt;
    &lt;Route <span class=hljs-attr>path</span>=<span
                    class=hljs-string>"/polls"</span> <span
                    class=hljs-attr>component</span>={<span
                    class=hljs-literal>Polls</span>} /&gt;
    &lt;Route <span class=hljs-attr>path</span>=<span
                    class=hljs-string>"/finder"</span> <span
                    class=hljs-attr>component</span>={<span
                    class=hljs-literal>Finder</span>} /&gt;
  &lt;/Router&gt;
);
</code></pre>
</section>

<section id="single-page-apps-animated" data-transition="fade-in">
<h2>Single page apps</h2>
<pre><code class="hljs js" data-trim data-noescape>
&lt;Router&gt;
  &lt;Route <span class=hljs-attr>render</span>={({ <span
                  class=hljs-variable>location</span> }) =&gt; (
<span class=highlight>    &lt;TransitionGroup&gt;
      &lt;CSSTransition <span
          class=hljs-attr>key</span>={<span
          class=hljs-variable>location.pathname</span>}
        <span class=hljs-attr>timeout</span>={<span
              class=hljs-literal>400</span>} <span
              class=hljs-attr>classNames</span>=<span
              class=hljs-string>"slide"</span>&gt;</span>
        &lt;Switch <span class=hljs-attr>location</span>={<span
                         class=hljs-variable>location</span>}&gt;
          &lt;Route exact <span class=hljs-attr>path</span>="/" <span
                                class=hljs-attr>component</span>={<span
                                class=hljs-literal>Photos</span>} /&gt;
          &lt;Route <span class=hljs-attr>path</span>=<span
                          class=hljs-string>"/polls"</span> <span
                          class=hljs-attr>component</span>={<span
                          class=hljs-literal>Polls</span>} /&gt;
          &lt;Route <span class=hljs-attr>path</span>=<span
                          class=hljs-string>"/finder"</span> <span
                          class=hljs-attr>component</span>={<span
                          class=hljs-literal>Finder</span>} /&gt;
        &lt;/Switch&gt;
<span class=highlight>      &lt;/CSSTransition&gt;
    &lt;/TransitionGroup&gt;</span>
  )}/&gt;
&lt;/Router&gt;
</code></pre>
<style>
#single-page-apps-animated code {
  font-size: 20px;
}
</style>
</section>

<section id="naive-single-page-app-explained">
<h2>When you click&hellip;</h2>
<div class=side-by-side>
  <ol>
    <li>Handle click
    <li>Create DOM elements
    <li>Resolve style
      <ul style="font-size: smaller">
        <li>(<code>&lt;CSSTransition&gt;</code> resolves style and layout
          multiple times)
      </ul>
    <li>Calculate layout
    <li>Paint each new element
    <li>Run the transition
  </ol>
  <img src="img/bad-router-profile.png">
</div>
<style>
#naive-single-page-app-explained .side-by-side ol {
  font-size: 25px;
}
#naive-single-page-app-explained .side-by-side img {
  width: 700px;
  margin-left: 50px;
}
</style>
</section>

<section id="fixed-single-page-app-proposal" data-transition=fade-out>
<h2>What about&hellip;</h2>
<pre><code class="hljs js" data-trim data-noescape>
&lt;Router&gt;
  &lt;Route <span class=hljs-attr>render</span>={({ <span
                  class=hljs-variable>location</span> }) =&gt; (
<span class=highlight>    &lt;Photos <span
      class=hljs-attr>active</span>={<span
      class=hljs-variable>location.pathname</span> === <span
      class=hljs-string>'/'</span>}/&gt;
    &lt;Polls <span class=hljs-attr>active</span>={<span
                    class=hljs-variable>location.pathname</span> === <span
                    class=hljs-string>'/stories'</span>}/&gt;
    &lt;Finder <span class=hljs-attr>active</span>={<span
                    class=hljs-variable>location.pathname</span> === <span
                    class=hljs-string>'/notes'</span>}/&gt;</span>
  )}/&gt;
&lt;/Router&gt;
</code></pre>
</section>

<section id="fixed-single-page-app-explained" data-transition=fade>
<h2>When you click&hellip;</h2>
<ol>
  <li>Handle click
  <li class=strike>Create DOM elements
  <li>Resolve style
    <ul style="font-size: smaller" class=strike>
      <li>(<code>&lt;CSSTransition&gt;</code> resolves style and layout
        multiple times)
    </ul>
  <li class=strike>Calculate layout
  <li class=strike>Paint each new element
  <li>Run the transition
</ol>
<style>
#fixed-single-page-app-explained .side-by-side ol {
  font-size: 25px;
}
#fixed-single-page-app-explained .side-by-side img {
  width: 700px;
  margin-left: 50px;
}
#fixed-single-page-app-explained .strike {
  text-decoration: line-through;
  opacity: .5;
}
</style>
</section>

<section id="single-page-app-comparison">
<div class="side-by-side">
  <figure>
    <img src="img/bad-router-profile.png">
    <figcaption>Before (~100ms)</figcaption>
  </figure>
  <figure>
    <img src="img/better-router-profile.png">
    <figcaption>After (~30ms)</figcaption>
  </figure>
</div>
<style>
#single-page-app-comparison > * {
  margin: 0 .5em;
}
</style>
</section>

<!-- New things to look out for
  - offset-path
  - prefers-reduced-motion
  - timing function steps
  - translate, scale, rotate
-->

<section id="thankyou" data-transition="fade">
<h2>ご清聴ありがとうございました</h2>
<div class=slides-link>
  <a href="https://birtles.github.io/pwanight13/"
    target="_blank">birtles.github.io/pwanight13/</a>
</div>
<div class=links>
  <div class=link>
    <a href="https://twitter.com/brianskold" target=_blank><img class=logo
       src="img/twitter-avatar.png"></a>
    <a href="https://twitter.com/brianskold" target=_blank>@brianskold</a>
  </div>
  <div class=link>
    <a href="https://birchill.co.jp" target=_blank><img class=logo
       src="img/birchill-logo.svg"></a>
    <a href="https://birchill.co.jp" target=_blank>birchill.co.jp</a>
  </div>
</div>
<style>
#thankyou h2 {
  color: var(--red-6);
  text-shadow: var(--red-2) 0px 3px 3px;
}
#thankyou .slides-link,
#thankyou .links {
  margin: 1em 0;
}

#thankyou a,
#thankyou a:visited {
  color: var(--green-dark);
  text-decoration: underline dotted 2px;
}

#thankyou .links {
  display: flex;
  align-items: center;
  justify-content: center;
}
#thankyou .link {
  display: flex;
  flex-direction: column;
  align-items: center;
  margin-left: 1em;
  margin-right: 1em;
}
#thankyou .link img {
  border: none;
  box-shadow: none;
  width: 150px;
  height: 150px;
}
#thankyou .link a {
  display: block;
}
</style>
</section>

</div> <!-- end slides -->
</div> <!-- end reveal -->

<script src="lib/js/head.min.js"></script>
<script src="js/reveal.js"></script>

<script>
Reveal.initialize({
  dependencies: [
    { src: 'plugin/notes/notes.js', async: true },
    {
      src: 'plugin/highlight/highlight.js',
      async: true,
      callback: function() {
        hljs.initHighlightingOnLoad();
      },
    },
  ],
  history: true,
  transition: 'fade',
});
</script>
</body>
</html>
